<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Survivor 50 Fantasy Draft</title>

  <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <style>
    @keyframes spin-anim {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(1440deg); }
    }
    .wheel-spinning { animation: spin-anim 2.5s cubic-bezier(0.2, 0.8, 0.4, 1) forwards; display:inline-block; }

    @keyframes bounce-in {
      0%   { transform: scale(0.5); opacity: 0; }
      70%  { transform: scale(1.1); }
      100% { transform: scale(1);   opacity: 1; }
    }
    .bounce-in { animation: bounce-in 0.5s ease forwards; }

    .drag-over { outline: 3px dashed #f97316; background: rgba(249,115,22,0.08); }

    /* Tab active glow */
    .tab-active { box-shadow: 0 0 0 3px #f97316, 0 4px 12px rgba(249,115,22,0.4); }
  </style>
</head>
<body class="bg-amber-50">
  <div id="root"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAqjvPwe4DaLNPNQYAIYOpCUrOZNdf7kC8",
      authDomain: "surviving-the-leifeld.firebaseapp.com",
      projectId: "surviving-the-leifeld",
      storageBucket: "surviving-the-leifeld.firebasestorage.app",
      messagingSenderId: "370494353013",
      appId: "1:370494353013:web:abed60693421e0cef7923c"
    };
    try {
      firebase.initializeApp(firebaseConfig);
      window._db = firebase.database();
    } catch(e) {
      console.error('Firebase init error:', e);
      window._db = null;
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const CONTESTANTS = [
      { name: "Aubry Bracco",             seasons: "KaÃ´h RÅng, Game Changers, EoE",              placement: "5th, 6th, 6th"          },
      { name: "Quintavius 'Q' Burdette",  seasons: "Survivor 46",                                placement: "5th"                    },
      { name: "Charlie Davis",            seasons: "Survivor 46",                                placement: "Winner"                 },
      { name: "Rick Devens",              seasons: "Edge of Extinction",                         placement: "4th"                    },
      { name: "Colby Donaldson",          seasons: "Australian Outback, All-Stars, HvV",         placement: "Runner-up, 12th, 5th"   },
      { name: "Tiffany Ervin",            seasons: "Survivor 46",                                placement: "7th"                    },
      { name: "Cirie Fields",             seasons: "Panama, Micronesia, HvV, GC",                placement: "4th, 3rd, 17th, 6th"    },
      { name: "Emily Flippen",            seasons: "Survivor 45",                                placement: "5th"                    },
      { name: "Kyle Fraser",              seasons: "Survivor 48",                                placement: "5th"                    },
      { name: "Chrissy Hofbeck",          seasons: "Heroes vs. Healers vs. Hustlers",            placement: "Runner-up"              },
      { name: "Christian Hubicki",        seasons: "David vs. Goliath",                          placement: "6th"                    },
      { name: "Joe Hunter",               seasons: "Survivor 48",                                placement: "Runner-up"              },
      { name: "Kamilla Karthigesu",       seasons: "Survivor 48",                                placement: "4th"                    },
      { name: "Angelina Keeley",          seasons: "David vs. Goliath",                          placement: "Runner-up"              },
      { name: "Stephenie LaGrossa",       seasons: "Palau, Guatemala, HvV",                      placement: "7th, Runner-up, 19th"   },
      { name: "Jenna Lewis",              seasons: "Borneo, All-Stars",                          placement: "8th, 3rd"               },
      { name: "Savannah Louie",           seasons: "Survivor 49",                                placement: "4th"                    },
      { name: "Ozzy Lusth",               seasons: "Cook Islands, Micronesia, SP, GC",           placement: "Runner-up, 9th, 4th, 12th"},
      { name: "Genevieve Mushaluk",       seasons: "Survivor 47",                                placement: "3rd"                    },
      { name: "Dee Valladares",           seasons: "Survivor 45",                                placement: "Winner"                 },
      { name: "Rizo Velovic",             seasons: "Survivor 49",                                placement: "7th"                    },
      { name: "Coach Wade",               seasons: "Tocantins, HvV, South Pacific",              placement: "5th, 8th, Runner-up"    },
      { name: "Mike White",               seasons: "David vs. Goliath",                          placement: "Runner-up"              },
      { name: "Jonathan Young",           seasons: "Survivor 42",                                placement: "5th"                    }
    ];

    const PLAYER_NAMES = ["JIM", "SANDY", "LOGAN", "SAM", "HALEY"];

    const PLAYER_COLORS = {
      JIM:   { bg: "bg-blue-600",   light: "bg-blue-100",   border: "border-blue-500",   text: "text-blue-700",   badge: "bg-blue-600"   },
      SANDY: { bg: "bg-pink-600",   light: "bg-pink-100",   border: "border-pink-500",   text: "text-pink-700",   badge: "bg-pink-600"   },
      LOGAN: { bg: "bg-emerald-600",light: "bg-emerald-100",border: "border-emerald-500",text: "text-emerald-700",badge: "bg-emerald-600" },
      SAM:   { bg: "bg-purple-600", light: "bg-purple-100", border: "border-purple-500", text: "text-purple-700", badge: "bg-purple-600"  },
      HALEY: { bg: "bg-amber-600",  light: "bg-amber-100",  border: "border-amber-500",  text: "text-amber-700",  badge: "bg-amber-600"   },
    };

    const fmt = s => {
      if (s == null) return '--:--';
      if (s >= 999999) return 'DNF';
      return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FIREBASE HOOK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function useFirebase() {
      const [state, setState] = useState({
        // shared global phase
        phase: 'hub',              // hub | draft | rewardSwap | exileSelect | exileChoice | complete
        // per-player data stored as objects keyed by player name
        rankings: {},              // { PLAYER: { 1: "Name", 2: "Name", ... } }
        playerPhase: {},           // { PLAYER: 'ranking'|'challenge'|'riskDecision'|'spinning'|'done' }
        challengeTimes: {},        // { PLAYER: seconds }
        riskRewards: {},           // { PLAYER: 'safe'|'penalty'|'reward' }
        spinResults: {},           // { PLAYER: 'reward'|'penalty' }
        teams: {},                 // { PLAYER: [name, name, ...] }
        exileTribe: [],
        exileSelections: {},       // { PLAYER: 0|1 }
        draftOrder: [],
      });
      const [ready, setReady] = useState(false);

      useEffect(() => {
        if (!window._db) { setReady(true); return; }
        const ref = window._db.ref('draft2');
        ref.on('value', snap => {
          const d = snap.val();
          if (d) setState(prev => ({ ...prev, ...d, exileTribe: d.exileTribe || [] }));
          setReady(true);
        });
        return () => ref.off();
      }, []);

      const save = useCallback((updates) => {
        setState(prev => {
          const next = { ...prev, ...updates };
          if (window._db) window._db.ref('draft2').update(updates);
          return next;
        });
      }, []);

      const reset = useCallback(() => {
        const fresh = {
          phase:'hub', rankings:{}, playerPhase:{}, challengeTimes:{},
          riskRewards:{}, spinResults:{}, teams:{}, exileTribe:[], exileSelections:{}, draftOrder:[]
        };
        setState(fresh);
        if (window._db) window._db.ref('draft2').set(fresh);
      }, []);

      return { state, save, reset, ready };
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PUZZLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const SOLVED = [[1,2,3],[4,5,6],[7,8,null]];
    function genPuzzle() {
      let g = SOLVED.map(r=>[...r]), er=2, ec=2;
      for (let i=0;i<60;i++){
        const moves=[];
        if(er>0)moves.push([-1,0]);if(er<2)moves.push([1,0]);
        if(ec>0)moves.push([0,-1]);if(ec<2)moves.push([0,1]);
        const [dr,dc]=moves[Math.floor(Math.random()*moves.length)];
        [g[er][ec],g[er+dr][ec+dc]]=[g[er+dr][ec+dc],g[er][ec]];
        er+=dr;ec+=dc;
      }
      return g;
    }
    function isSolved(g){ return JSON.stringify(g)===JSON.stringify(SOLVED); }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PLAYER PANEL (ranking + challenge + risk) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function PlayerPanel({ playerName, state, save }) {
      const pp = state.playerPhase[playerName] || 'ranking';
      const myRankings = state.rankings[playerName] || {};
      const ranked = Object.values(myRankings);
      const col = PLAYER_COLORS[playerName];

      // puzzle local state
      const [puzzle, setPuzzle] = useState(null);
      const [startTime, setStartTime] = useState(null);
      const [elapsed, setElapsed] = useState(0);
      const [isSpinning, setIsSpinning] = useState(false);
      const [spinDone, setSpinDone] = useState(false);

      useEffect(() => {
        if (pp === 'challenge' && !puzzle) {
          setPuzzle(genPuzzle());
          setStartTime(Date.now());
        }
      }, [pp]);

      useEffect(() => {
        if (pp !== 'challenge' || !startTime) return;
        const iv = setInterval(() => setElapsed(Math.floor((Date.now()-startTime)/1000)), 100);
        return () => clearInterval(iv);
      }, [pp, startTime]);

      const rankContestant = (cname) => {
        if (ranked.includes(cname)) return;
        const next = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]
          .find(r => !myRankings[r]);
        if (!next) return;
        const updated = { ...myRankings, [next]: cname };
        save({ rankings: { ...state.rankings, [playerName]: updated } });
      };

      const unrankSlot = (r) => {
        const updated = { ...myRankings };
        delete updated[r];
        save({ rankings: { ...state.rankings, [playerName]: updated } });
      };

      const submitRankings = () => {
        if (ranked.length !== 24) { alert('Rank all 24!'); return; }
        save({ playerPhase: { ...state.playerPhase, [playerName]: 'challenge' } });
        setPuzzle(genPuzzle());
        setStartTime(Date.now());
        setElapsed(0);
      };

      const moveTile = (row, col) => {
        if (!puzzle) return;
        const g = puzzle.map(r=>[...r]);
        let er,ec;
        for(let i=0;i<3;i++)for(let j=0;j<3;j++)if(g[i][j]===null){er=i;ec=j;}
        const adj=(row===er&&Math.abs(col-ec)===1)||(col===ec&&Math.abs(row-er)===1);
        if(!adj) return;
        [g[row][col],g[er][ec]]=[g[er][ec],g[row][col]];
        setPuzzle(g);
        if(isSolved(g)) finishChallenge(Math.floor((Date.now()-startTime)/1000));
      };

      const finishChallenge = (secs) => {
        save({
          challengeTimes: { ...state.challengeTimes, [playerName]: secs },
          playerPhase: { ...state.playerPhase, [playerName]: 'riskDecision' }
        });
      };

      const skipChallenge = () => finishChallenge(999999);

      const playItSafe = () => {
        save({
          riskRewards: { ...state.riskRewards, [playerName]: 'safe' },
          playerPhase: { ...state.playerPhase, [playerName]: 'done' }
        });
      };

      const spinWheel = () => {
        setIsSpinning(true);
        setSpinDone(false);
        setTimeout(() => {
          const result = Math.random() < 0.5 ? 'reward' : 'penalty';
          setIsSpinning(false);
          setSpinDone(true);
          save({
            riskRewards: { ...state.riskRewards, [playerName]: result },
            playerPhase: { ...state.playerPhase, [playerName]: 'done' }
          });
        }, 2800);
      };

      // â”€â”€ RANKING VIEW â”€â”€
      if (pp === 'ranking') return (
        <div className="space-y-4">
          <div className={`${col.bg} rounded-xl p-4 text-white`}>
            <h2 className="text-2xl font-black">{playerName} â€” Rank the Survivors</h2>
            <p className="text-white/80 text-sm mt-1">Click a contestant to assign the next available rank. Click a slot to unrank.</p>
            <div className="mt-2 font-bold">{ranked.length}/24 ranked</div>
          </div>

          {/* Rank slots */}
          <div className="bg-white rounded-xl border-2 border-gray-200 p-4">
            <p className="font-bold text-gray-600 mb-3 text-sm">RANK SLOTS â€” click to remove</p>
            <div className="grid grid-cols-8 gap-1.5">
              {Array.from({length:24},(_,i)=>i+1).map(r => (
                <button key={r} onClick={()=>unrankSlot(r)}
                  className={`rounded-lg p-2 text-center text-xs font-bold border-2 transition ${
                    myRankings[r]
                      ? `${col.light} ${col.border} ${col.text} hover:opacity-70`
                      : 'bg-gray-100 border-gray-200 text-gray-400'
                  }`}>
                  <div className="text-base font-black">{r}</div>
                  {myRankings[r] && <div className="truncate mt-0.5" style={{fontSize:'9px'}}>{myRankings[r].split(' ')[0]}</div>}
                </button>
              ))}
            </div>
          </div>

          {/* Contestant grid */}
          <div className="bg-white rounded-xl border-2 border-gray-200 p-4">
            <p className="font-bold text-gray-600 mb-3 text-sm">CONTESTANTS â€” click to rank</p>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
              {CONTESTANTS.map(c => {
                const isRanked = ranked.includes(c.name);
                const slot = Object.entries(myRankings).find(([,v])=>v===c.name)?.[0];
                return (
                  <button key={c.name} onClick={()=>rankContestant(c.name)} disabled={isRanked}
                    className={`text-left p-3 rounded-xl border-2 transition text-sm ${
                      isRanked
                        ? `${col.light} ${col.border} opacity-60 cursor-default`
                        : 'bg-orange-50 border-orange-200 hover:bg-orange-100 hover:border-orange-400 cursor-pointer'
                    }`}>
                    <div className="font-bold text-gray-900 leading-tight">{c.name}</div>
                    <div className="text-gray-500 text-xs mt-0.5">{c.seasons}</div>
                    {isRanked && <div className={`mt-1 font-black text-sm ${col.text}`}>#{slot}</div>}
                  </button>
                );
              })}
            </div>
          </div>

          <button onClick={submitRankings} disabled={ranked.length!==24}
            className={`w-full py-4 rounded-xl font-black text-xl text-white transition border-2 ${
              ranked.length===24 ? `${col.bg} border-transparent hover:opacity-90` : 'bg-gray-300 border-gray-300 cursor-not-allowed'
            }`}>
            ğŸï¸ Start Immunity Challenge â†’
          </button>
        </div>
      );

      // â”€â”€ CHALLENGE VIEW â”€â”€
      if (pp === 'challenge') return (
        <div className="space-y-4">
          <div className={`${col.bg} rounded-xl p-4 text-white flex items-center justify-between`}>
            <div>
              <h2 className="text-2xl font-black">{playerName} â€” Sliding Puzzle</h2>
              <p className="text-white/80 text-sm">Arrange 1â€“8 in order!</p>
            </div>
            <div className="text-right">
              <div className="text-4xl font-black font-mono">{fmt(elapsed)}</div>
            </div>
          </div>
          <div className="bg-white rounded-xl border-2 border-gray-200 p-6">
            <div className="grid grid-cols-3 gap-3 max-w-xs mx-auto">
              {(puzzle||SOLVED).map((row,ri)=>row.map((tile,ci)=>(
                <button key={`${ri}-${ci}`} onClick={()=>moveTile(ri,ci)}
                  className={`h-24 text-4xl font-black rounded-xl transition ${
                    tile===null?'bg-gray-100 cursor-default'
                    :`${col.bg} text-white hover:opacity-90 shadow-lg active:scale-95`
                  }`}>{tile}</button>
              )))}
            </div>
          </div>
          <button onClick={skipChallenge}
            className="w-full py-3 rounded-xl bg-gray-500 text-white font-bold hover:bg-gray-600 transition">
            Skip (DNF)
          </button>
        </div>
      );

      // â”€â”€ RISK DECISION VIEW â”€â”€
      if (pp === 'riskDecision') return (
        <div className="space-y-4">
          <div className={`${col.bg} rounded-xl p-6 text-white text-center`}>
            <div className="text-5xl mb-2">âš”ï¸</div>
            <h2 className="text-3xl font-black">Challenge Complete!</h2>
            <p className="text-2xl font-bold mt-1 font-mono">{playerName}: {fmt(state.challengeTimes[playerName])}</p>
          </div>
          <div className="bg-white rounded-xl border-2 border-gray-200 p-6">
            <h3 className="text-2xl font-black text-center text-gray-800 mb-2">Risk vs. Reward</h3>
            <p className="text-center text-gray-600 mb-6">Choose your fate...</p>
            <div className="grid grid-cols-2 gap-4">
              <button onClick={playItSafe}
                className="bg-blue-600 text-white p-6 rounded-xl border-4 border-blue-800 hover:bg-blue-700 transition">
                <div className="text-4xl mb-2">ğŸ›¡ï¸</div>
                <div className="text-xl font-black">Play It Safe</div>
                <p className="text-blue-200 text-sm mt-2">Keep your time. No risk, no reward.</p>
              </button>
              <button onClick={spinWheel}
                className="bg-red-600 text-white p-6 rounded-xl border-4 border-red-800 hover:bg-red-700 transition">
                <div className="text-4xl mb-2">ğŸ°</div>
                <div className="text-xl font-black">Risk It!</div>
                <p className="text-red-200 text-sm mt-2">
                  <strong>Win:</strong> Swap 1 of your drafted players for anyone on Exile Island after the draft<br/>
                  <strong>Lose:</strong> Draft last regardless of your time<br/>
                  50/50 odds
                </p>
              </button>
            </div>
          </div>
        </div>
      );

      // â”€â”€ SPINNING VIEW (shown immediately after clicking Risk) â”€â”€
      if (pp === 'done' && (state.riskRewards[playerName] === 'reward' || state.riskRewards[playerName] === 'penalty') && !state.riskRewards[playerName]?.seen) {
        const result = state.riskRewards[playerName];
        return (
          <div className="bg-white rounded-xl border-2 border-gray-200 p-10 text-center space-y-6">
            <div className={`text-8xl bounce-in`}>{result==='reward'?'ğŸ†':'ğŸ’€'}</div>
            <h2 className={`text-4xl font-black ${result==='reward'?'text-green-600':'text-red-600'}`}>
              {result==='reward'?'REWARD!':'PENALTY!'}
            </h2>
            <p className="text-xl text-gray-700">
              {result==='reward'
                ? 'After the draft, you can swap one of your players for anyone on Exile Island!'
                : 'You will draft last, regardless of your puzzle time.'}
            </p>
            <div className={`inline-block px-6 py-2 rounded-full text-white font-bold ${result==='reward'?'bg-green-600':'bg-red-600'}`}>
              Turn complete âœ“
            </div>
          </div>
        );
      }

      // â”€â”€ DONE VIEW â”€â”€
      const rr = state.riskRewards[playerName];
      return (
        <div className={`rounded-xl p-8 text-center space-y-4 ${col.light} border-2 ${col.border}`}>
          <div className="text-6xl">âœ…</div>
          <h2 className={`text-3xl font-black ${col.text}`}>{playerName} â€” Done!</h2>
          <p className="text-gray-700 text-lg">Challenge time: <strong className="font-mono">{fmt(state.challengeTimes[playerName])}</strong></p>
          {rr === 'safe'    && <div className="inline-block bg-blue-100 text-blue-800 px-4 py-2 rounded-full font-bold">ğŸ›¡ï¸ Played It Safe</div>}
          {rr === 'reward'  && <div className="inline-block bg-green-100 text-green-800 px-4 py-2 rounded-full font-bold">ğŸ† WON a Reward!</div>}
          {rr === 'penalty' && <div className="inline-block bg-red-100 text-red-800 px-4 py-2 rounded-full font-bold">ğŸ’€ Got a Penalty â€” drafts last</div>}
          <p className="text-gray-500 text-sm">Waiting for other players to finish...</p>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SPINNING OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function SpinningOverlay({ playerName, onDone }) {
      const [done, setDone] = useState(false);
      const [result] = useState(Math.random() < 0.5 ? 'reward' : 'penalty');
      useEffect(() => {
        const t = setTimeout(() => setDone(true), 2800);
        return () => clearTimeout(t);
      }, []);
      return (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
          <div className="bg-white rounded-2xl p-12 text-center max-w-md w-full mx-4 shadow-2xl">
            {!done ? (
              <>
                <div className="text-8xl wheel-spinning mb-6">ğŸ¡</div>
                <p className="text-2xl font-black text-gray-800">Spinning for {playerName}...</p>
              </>
            ) : (
              <div className="bounce-in space-y-4">
                <div className="text-8xl">{result==='reward'?'ğŸ†':'ğŸ’€'}</div>
                <h2 className={`text-4xl font-black ${result==='reward'?'text-green-600':'text-red-600'}`}>
                  {result==='reward'?'REWARD!':'PENALTY!'}
                </h2>
                <p className="text-gray-700">
                  {result==='reward'
                    ? 'After the draft you can swap one drafted player for an exiled player!'
                    : 'You will draft last!'}
                </p>
                <button onClick={()=>onDone(result)}
                  className={`w-full py-3 rounded-xl text-white font-black text-lg ${result==='reward'?'bg-green-600':'bg-red-600'}`}>
                  Continue â†’
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HUB SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function HubScreen({ state, save }) {
      const [activeTab, setActiveTab] = useState(null);
      const [spinningFor, setSpinningFor] = useState(null);

      const allDone = PLAYER_NAMES.every(p => (state.playerPhase[p]||'ranking') === 'done');

      // If a player is in riskDecision and has clicked Risk, show spinner
      // We handle spin at hub level so the overlay shows globally
      const handleSpinDone = (playerName, result) => {
        save({
          riskRewards: { ...state.riskRewards, [playerName]: result },
          playerPhase: { ...state.playerPhase, [playerName]: 'done' }
        });
        setSpinningFor(null);
      };

      const startDraft = () => {
        // Determine draft order
        let sorted = [...PLAYER_NAMES].sort((a,b)=>(state.challengeTimes[a]||999999)-(state.challengeTimes[b]||999999));
        const penalties = sorted.filter(p=>state.riskRewards[p]==='penalty');
        const normal = sorted.filter(p=>state.riskRewards[p]!=='penalty');
        const order = [...normal, ...penalties];
        const initTeams = {};
        PLAYER_NAMES.forEach(p=>initTeams[p]=[]);
        save({ draftOrder: order, teams: initTeams, exileTribe: [], phase: 'draft' });
      };

      return (
        <div className="max-w-7xl mx-auto space-y-6">
          {spinningFor && (
            <SpinningOverlay playerName={spinningFor} onDone={(r)=>handleSpinDone(spinningFor,r)} />
          )}

          {/* Header */}
          <div className="bg-gradient-to-r from-red-700 via-orange-600 to-yellow-500 rounded-2xl p-8 text-white text-center shadow-2xl">
            <div className="text-6xl mb-2">ğŸ”¥</div>
            <h1 className="text-5xl font-black tracking-tight" style={{textShadow:'0 2px 8px rgba(0,0,0,0.4)'}}>SURVIVOR 50</h1>
            <p className="text-2xl font-bold text-yellow-200 mt-1">FANTASY DRAFT</p>
            <p className="text-orange-100 mt-1">24 Legends Â· 5 Players Â· 1 Winner</p>
          </div>

          {/* Status row */}
          <div className="grid grid-cols-5 gap-3">
            {PLAYER_NAMES.map(p => {
              const pp = state.playerPhase[p] || 'ranking';
              const col = PLAYER_COLORS[p];
              const rr = state.riskRewards[p];
              const isActive = activeTab === p;
              const isDone = pp === 'done';
              return (
                <button key={p} onClick={()=>setActiveTab(isActive ? null : p)}
                  className={`rounded-xl p-4 text-center transition border-3 border-transparent ${
                    isDone ? `${col.light} ${col.border}` : 'bg-white border-gray-200 hover:border-gray-400'
                  } ${isActive ? 'tab-active' : ''}`}>
                  <div className={`text-2xl font-black ${isDone ? col.text : 'text-gray-800'}`}>{p}</div>
                  <div className="text-xs mt-1 font-medium text-gray-500">
                    {pp==='ranking'&&`${Object.keys(state.rankings[p]||{}).length}/24 ranked`}
                    {pp==='challenge'&&'â± In challenge'}
                    {pp==='riskDecision'&&'âš”ï¸ Risk/Reward'}
                    {pp==='done'&&`âœ“ ${fmt(state.challengeTimes[p])}`}
                  </div>
                  {rr==='reward'  && <div className="text-xs mt-1 text-green-600 font-bold">ğŸ† Reward</div>}
                  {rr==='penalty' && <div className="text-xs mt-1 text-red-600 font-bold">ğŸ’€ Penalty</div>}
                </button>
              );
            })}
          </div>

          {/* Active player panel */}
          {activeTab && (
            <div className="bg-white rounded-2xl shadow-xl border-2 border-gray-200 p-6">
              <div className="flex justify-between items-center mb-4">
                <h2 className={`text-2xl font-black ${PLAYER_COLORS[activeTab].text}`}>{activeTab}'s CAMP</h2>
                <button onClick={()=>setActiveTab(null)}
                  className="text-gray-400 hover:text-gray-700 text-2xl font-bold leading-none">âœ•</button>
              </div>
              <PlayerPanel playerName={activeTab} state={state} save={save} />
            </div>
          )}

          {!activeTab && (
            <div className="bg-white rounded-2xl border-2 border-gray-200 p-8 text-center">
              <p className="text-gray-500 text-lg">ğŸ‘† Click a player name above to open their panel</p>
              <p className="text-gray-400 text-sm mt-1">All players can have their panels open on separate devices simultaneously</p>
            </div>
          )}

          {/* All done â†’ start draft */}
          {allDone && (
            <div className="bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl p-8 text-white text-center shadow-xl">
              <div className="text-5xl mb-3">ğŸ‰</div>
              <h2 className="text-3xl font-black mb-2">All Players Complete!</h2>
              <div className="grid grid-cols-5 gap-3 mb-6">
                {PLAYER_NAMES.map(p=>{
                  const rr=state.riskRewards[p];
                  return (
                    <div key={p} className="bg-white/20 rounded-xl p-3">
                      <div className="font-black text-lg">{p}</div>
                      <div className="font-mono text-sm">{fmt(state.challengeTimes[p])}</div>
                      {rr==='penalty'&&<div className="text-xs mt-1">ğŸ’€ Last pick</div>}
                      {rr==='reward' &&<div className="text-xs mt-1">ğŸ† Swap reward</div>}
                    </div>
                  );
                })}
              </div>
              <button onClick={startDraft}
                className="bg-white text-emerald-700 px-10 py-4 rounded-xl font-black text-2xl hover:bg-green-50 transition shadow-lg">
                ğŸ”¥ Start the Draft â†’
              </button>
            </div>
          )}
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DRAFT SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function DraftScreen({ state, save }) {
      const [dragging, setDragging] = useState(null); // { name, from: 'available'|'team:PLAYER'|'exile' }
      const [dragOver, setDragOver] = useState(null); // 'team:PLAYER'|'exile'

      const allDrafted = Object.values(state.teams).flat();
      const exiled = state.exileTribe || [];
      const claimed = [...allDrafted, ...exiled];
      const available = CONTESTANTS.map(c=>c.name).filter(n=>!claimed.includes(n));
      const total = claimed.length;

      const getOwner = (name) => {
        for (const p of PLAYER_NAMES) {
          if (state.teams[p]?.includes(name)) return p;
        }
        return null;
      };

      const onDragStart = (e, name, from) => {
        setDragging({ name, from });
        e.dataTransfer.effectAllowed = 'move';
      };

      const onDragOver = (e, zone) => {
        e.preventDefault();
        setDragOver(zone);
      };

      const onDrop = (e, zone) => {
        e.preventDefault();
        setDragOver(null);
        if (!dragging) return;
        const { name } = dragging;

        const newTeams = {};
        PLAYER_NAMES.forEach(p => newTeams[p] = [...(state.teams[p]||[])]);
        let newExile = [...exiled];

        // Remove from current location
        PLAYER_NAMES.forEach(p => { newTeams[p] = newTeams[p].filter(c=>c!==name); });
        newExile = newExile.filter(c=>c!==name);

        if (zone === 'exile') {
          if (newExile.length >= 4) { alert('Exile Island is full (max 4)!'); setDragging(null); return; }
          newExile.push(name);
        } else {
          // zone = 'team:PLAYER'
          const targetPlayer = zone.replace('team:','');
          if ((newTeams[targetPlayer]||[]).length >= 4) { alert(`${targetPlayer} already has 4!`); setDragging(null); return; }
          newTeams[targetPlayer].push(name);
        }

        save({ teams: newTeams, exileTribe: newExile });
        setDragging(null);
      };

      const onDragEnd = () => { setDragging(null); setDragOver(null); };

      const finishDraft = () => {
        for (const p of PLAYER_NAMES) {
          if ((state.teams[p]||[]).length !== 4) { alert(`${p} needs exactly 4 contestants!`); return; }
        }
        if (exiled.length !== 4) { alert(`Exile Island needs exactly 4 (has ${exiled.length})!`); return; }
        const rewardPlayers = PLAYER_NAMES.filter(p=>state.riskRewards[p]==='reward');
        if (rewardPlayers.length > 0) {
          save({ phase: 'rewardSwap', selectedRewardPlayer: rewardPlayers[0] });
        } else {
          save({ phase: 'exileSelect' });
        }
      };

      return (
        <div className="max-w-7xl mx-auto space-y-6">
          <div className="bg-gradient-to-r from-orange-700 to-red-700 rounded-2xl p-6 text-white shadow-xl">
            <h1 className="text-4xl font-black">ğŸ”¥ Draft Board</h1>
            <p className="text-orange-200 mt-1">Drag contestants from the table into team slots or Exile Island â€¢ {total}/24 placed</p>
            <div className="flex gap-3 mt-3 flex-wrap">
              {state.draftOrder.map((p,i) => (
                <div key={p} className={`${PLAYER_COLORS[p].badge} text-white px-3 py-1 rounded-full text-sm font-bold`}>
                  {i+1}. {p} {state.riskRewards[p]==='penalty'&&'ğŸ’€'} {state.riskRewards[p]==='reward'&&'ğŸ†'}
                </div>
              ))}
            </div>
          </div>

          {/* Team drop zones */}
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
            {PLAYER_NAMES.map(p => {
              const col = PLAYER_COLORS[p];
              const zone = `team:${p}`;
              const isOver = dragOver === zone;
              return (
                <div key={p}
                  onDragOver={e=>onDragOver(e,zone)}
                  onDrop={e=>onDrop(e,zone)}
                  onDragLeave={()=>setDragOver(null)}
                  className={`rounded-xl border-3 p-3 min-h-40 transition ${col.border} ${isOver?'drag-over':col.light}`}>
                  <div className={`font-black text-sm text-center mb-2 ${col.text}`}>{p}</div>
                  <div className={`text-xs text-center mb-2 ${col.text}`}>{(state.teams[p]||[]).length}/4</div>
                  <div className="space-y-1.5">
                    {(state.teams[p]||[]).map(name=>(
                      <div key={name} draggable onDragStart={e=>onDragStart(e,name,`team:${p}`)} onDragEnd={onDragEnd}
                        className={`${col.bg} text-white px-2 py-1.5 rounded-lg text-xs font-bold cursor-move leading-tight`}>
                        {name}
                      </div>
                    ))}
                  </div>
                </div>
              );
            })}

            {/* Exile Island */}
            <div onDragOver={e=>onDragOver(e,'exile')} onDrop={e=>onDrop(e,'exile')} onDragLeave={()=>setDragOver(null)}
              className={`rounded-xl border-3 p-3 min-h-40 transition border-red-600 ${dragOver==='exile'?'drag-over':'bg-red-50'}`}>
              <div className="font-black text-sm text-center text-red-700 mb-2">ğŸï¸ Exile</div>
              <div className="text-xs text-center text-red-500 mb-2">{exiled.length}/4</div>
              <div className="space-y-1.5">
                {exiled.map(name=>(
                  <div key={name} draggable onDragStart={e=>onDragStart(e,name,'exile')} onDragEnd={onDragEnd}
                    className="bg-red-600 text-white px-2 py-1.5 rounded-lg text-xs font-bold cursor-move leading-tight">
                    {name}
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Rankings table â€” drag source */}
          <div className="bg-white rounded-2xl border-2 border-gray-200 shadow-lg overflow-x-auto">
            <div className="p-4 border-b border-gray-200">
              <h3 className="font-black text-xl text-gray-800">ğŸ“‹ Rankings â€” drag any available contestant into a team slot or exile</h3>
              <div className="flex gap-4 mt-2 text-xs font-medium">
                <span className="bg-blue-100 text-blue-700 px-2 py-1 rounded">Blue = available (draggable)</span>
                <span className="bg-gray-200 text-gray-500 px-2 py-1 rounded">Gray = drafted</span>
                <span className="bg-red-100 text-red-600 px-2 py-1 rounded">Red = exiled</span>
              </div>
            </div>
            <table className="w-full text-xs">
              <thead>
                <tr className="bg-orange-50 border-b-2 border-orange-300">
                  <th className="p-2 text-left font-black text-gray-600 w-10">Rank</th>
                  {state.draftOrder.map((p,i) => (
                    <th key={p} className="p-2 text-center font-black">
                      <div className={`inline-flex flex-col items-center`}>
                        <div className={`w-7 h-7 rounded-full text-white flex items-center justify-center font-black text-sm ${PLAYER_COLORS[p].bg}`}>{i+1}</div>
                        <div className={`mt-1 ${PLAYER_COLORS[p].text}`}>{p}</div>
                        <div className="text-gray-400 font-normal">{fmt(state.challengeTimes[p])}</div>
                      </div>
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {Array.from({length:24},(_,i)=>i+1).map(rank => (
                  <tr key={rank} className="border-b border-gray-100 hover:bg-orange-50/50">
                    <td className="p-2 font-black text-gray-500">{rank}</td>
                    {state.draftOrder.map(p => {
                      const name = state.rankings[p]?.[rank];
                      if (!name) return <td key={p} className="p-2 text-center text-gray-300">â€”</td>;
                      const owner = getOwner(name);
                      const isExiled = exiled.includes(name);
                      const isAvailable = !owner && !isExiled;
                      const ownerColor = owner ? PLAYER_COLORS[owner] : null;
                      return (
                        <td key={p} className="p-1.5">
                          <div
                            draggable={isAvailable}
                            onDragStart={isAvailable ? e=>onDragStart(e,name,'available') : undefined}
                            onDragEnd={onDragEnd}
                            className={`px-2 py-1.5 rounded-lg font-medium leading-tight transition ${
                              isAvailable   ? 'bg-blue-100 text-blue-800 border border-blue-300 cursor-move hover:bg-blue-200' :
                              isExiled      ? 'bg-red-100 text-red-600 border border-red-200 opacity-60' :
                              owner===p     ? `${ownerColor.light} ${ownerColor.text} ${ownerColor.border} border font-bold` :
                              'bg-gray-100 text-gray-400 border border-gray-200 opacity-50'
                            }`}>
                            {name}
                            {owner===p && <span className="ml-1 text-xs opacity-70">âœ“</span>}
                          </div>
                        </td>
                      );
                    })}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <button onClick={finishDraft}
            disabled={total<24}
            className={`w-full py-4 rounded-xl font-black text-xl text-white transition ${
              total===24?'bg-green-600 hover:bg-green-700':'bg-gray-300 cursor-not-allowed'
            }`}>
            Complete Draft ({total}/24 placed) â†’
          </button>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ REWARD SWAP SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function RewardSwapScreen({ state, save }) {
      const playerName = state.selectedRewardPlayer;
      const [swapFrom, setSwapFrom] = useState(null);
      const [swapTo, setSwapTo] = useState(null);

      if (!playerName) return null;

      const executeSwap = () => {
        if (!swapFrom || !swapTo) { alert('Select one from your team and one from exile!'); return; }
        const newTeams = {};
        PLAYER_NAMES.forEach(p => newTeams[p] = [...(state.teams[p]||[])]);
        newTeams[playerName] = newTeams[playerName].filter(c=>c!==swapFrom);
        newTeams[playerName].push(swapTo);
        const newExile = (state.exileTribe||[]).filter(c=>c!==swapTo);
        newExile.push(swapFrom);

        const rewardPlayers = PLAYER_NAMES.filter(p=>state.riskRewards[p]==='reward');
        const idx = rewardPlayers.indexOf(playerName);
        const next = rewardPlayers[idx+1];

        save({ teams: newTeams, exileTribe: newExile,
          selectedRewardPlayer: next||null,
          phase: next ? 'rewardSwap' : 'exileSelect' });
        setSwapFrom(null); setSwapTo(null);
      };

      const skip = () => {
        const rewardPlayers = PLAYER_NAMES.filter(p=>state.riskRewards[p]==='reward');
        const idx = rewardPlayers.indexOf(playerName);
        const next = rewardPlayers[idx+1];
        save({ selectedRewardPlayer: next||null, phase: next ? 'rewardSwap' : 'exileSelect' });
        setSwapFrom(null); setSwapTo(null);
      };

      const col = PLAYER_COLORS[playerName];

      return (
        <div className="max-w-4xl mx-auto space-y-6">
          <div className={`${col.bg} rounded-2xl p-8 text-white text-center shadow-xl`}>
            <div className="text-5xl mb-3">ğŸ†</div>
            <h1 className="text-4xl font-black">{playerName}'s Reward!</h1>
            <p className="text-white/80 text-lg mt-2">Swap one of your drafted players for anyone on Exile Island</p>
          </div>
          <div className="grid grid-cols-2 gap-6">
            <div className="bg-white rounded-2xl border-2 border-gray-200 p-6">
              <h3 className="font-black text-lg text-gray-800 mb-4">Your Team <span className="text-gray-400 font-normal text-sm">(pick one to exile)</span></h3>
              <div className="space-y-2">
                {(state.teams[playerName]||[]).map(c=>(
                  <button key={c} onClick={()=>setSwapFrom(c)}
                    className={`w-full p-3 rounded-xl font-medium transition border-2 text-left ${
                      swapFrom===c?'bg-red-100 border-red-500 text-red-900':'bg-gray-50 border-gray-200 hover:border-red-300'
                    }`}>{c} {swapFrom===c&&'â†’ exile'}</button>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-2xl border-2 border-gray-200 p-6">
              <h3 className="font-black text-lg text-gray-800 mb-4">Exile Island <span className="text-gray-400 font-normal text-sm">(pick one to bring back)</span></h3>
              <div className="space-y-2">
                {(state.exileTribe||[]).map(c=>(
                  <button key={c} onClick={()=>setSwapTo(c)}
                    className={`w-full p-3 rounded-xl font-medium transition border-2 text-left ${
                      swapTo===c?'bg-green-100 border-green-500 text-green-900':'bg-gray-50 border-gray-200 hover:border-green-300'
                    }`}>{c} {swapTo===c&&'â†’ your team'}</button>
                ))}
              </div>
            </div>
          </div>
          <div className="flex gap-4">
            <button onClick={executeSwap} disabled={!swapFrom||!swapTo}
              className={`flex-1 py-4 rounded-xl font-black text-xl text-white transition ${swapFrom&&swapTo?'bg-green-600 hover:bg-green-700':'bg-gray-300 cursor-not-allowed'}`}>
              Execute Swap â†’
            </button>
            <button onClick={skip} className="px-8 py-4 rounded-xl bg-gray-500 text-white font-bold hover:bg-gray-600 transition">
              Skip
            </button>
          </div>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EXILE SELECTION SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function ExileSelectScreen({ state, save }) {
      const [activePlayer, setActivePlayer] = useState(null);
      const tribe1 = (state.exileTribe||[]).filter((_,i)=>i%2===0);
      const tribe2 = (state.exileTribe||[]).filter((_,i)=>i%2!==0);
      const done = PLAYER_NAMES.filter(p=>state.exileSelections[p]!==undefined);

      const choose = (player, idx) => {
        const newSel = { ...state.exileSelections, [player]: idx };
        if (Object.keys(newSel).length === PLAYER_NAMES.length) {
          save({ exileSelections: newSel, phase: 'complete' });
        } else {
          save({ exileSelections: newSel });
          setActivePlayer(null);
        }
      };

      if (activePlayer) {
        const col = PLAYER_COLORS[activePlayer];
        return (
          <div className="max-w-4xl mx-auto space-y-6">
            <div className={`${col.bg} rounded-2xl p-6 text-white text-center`}>
              <h1 className="text-3xl font-black">{activePlayer} â€” Choose Your Exile Tribe</h1>
              <p className="text-white/80 mt-1">Pick the exile tribe you want as your 5th team member</p>
            </div>
            <div className="grid grid-cols-2 gap-6">
              {[tribe1,tribe2].map((tribe,i)=>(
                <button key={i} onClick={()=>choose(activePlayer,i)}
                  className={`p-8 rounded-2xl border-4 text-left transition hover:scale-105 ${i===0?'bg-purple-700 border-purple-900 text-white':'bg-teal-700 border-teal-900 text-white'}`}>
                  <h3 className="text-2xl font-black mb-4">ğŸï¸ Tribe {i===0?'A':'B'}</h3>
                  <ul className="space-y-2">
                    {tribe.map((c,j)=><li key={j} className="bg-white/20 px-3 py-2 rounded-lg font-medium">{c}</li>)}
                  </ul>
                </button>
              ))}
            </div>
            <button onClick={()=>setActivePlayer(null)} className="w-full py-3 rounded-xl bg-gray-500 text-white font-bold hover:bg-gray-600">â† Back</button>
          </div>
        );
      }

      return (
        <div className="max-w-4xl mx-auto space-y-6">
          <div className="bg-gradient-to-r from-purple-700 to-pink-600 rounded-2xl p-8 text-white text-center shadow-xl">
            <div className="text-5xl mb-3">ğŸï¸</div>
            <h1 className="text-4xl font-black">Secret Exile Selection</h1>
            <p className="text-purple-200 mt-2">Each player privately chooses which exile tribe they want as a 5th member</p>
          </div>
          <div className="bg-white rounded-2xl border-2 border-gray-200 p-6">
            <h2 className="text-2xl font-black text-gray-800 mb-4">Who's making their selection? ({done.length}/5)</h2>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {PLAYER_NAMES.map(p=>{
                const isDone = state.exileSelections[p]!==undefined;
                const col = PLAYER_COLORS[p];
                return (
                  <button key={p} onClick={()=>!isDone&&setActivePlayer(p)} disabled={isDone}
                    className={`p-6 rounded-xl font-black text-xl transition border-2 ${
                      isDone?`${col.light} ${col.border} ${col.text} cursor-default`:`${col.bg} text-white border-transparent hover:opacity-90`
                    }`}>
                    {p}
                    {isDone&&<div className="text-sm font-normal mt-1">âœ“ Chosen</div>}
                  </button>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ COMPLETE SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function CompleteScreen({ state, save }) {
      const [code, setCode] = useState('');
      const tribe1 = (state.exileTribe||[]).filter((_,i)=>i%2===0);
      const tribe2 = (state.exileTribe||[]).filter((_,i)=>i%2!==0);

      const reset = () => {
        if (code !== 'SURVIVOR50') { alert('Wrong code!'); return; }
        if (!confirm('Reset everything?')) return;
        save({
          phase:'hub', rankings:{}, playerPhase:{}, challengeTimes:{},
          riskRewards:{}, teams:{}, exileTribe:[], exileSelections:{}, draftOrder:[], selectedRewardPlayer:null
        });
      };

      return (
        <div className="max-w-7xl mx-auto space-y-6">
          <div className="bg-gradient-to-r from-green-700 to-emerald-700 rounded-2xl p-10 text-white text-center shadow-2xl">
            <div className="text-6xl mb-4">ğŸ†</div>
            <h1 className="text-5xl font-black">THE TRIBE HAS SPOKEN!</h1>
            <p className="text-green-200 text-xl mt-2">Teams are set. May the best Survivor win! ğŸ”¥</p>
          </div>

          {/* Teams */}
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
            {PLAYER_NAMES.map(p => {
              const col = PLAYER_COLORS[p];
              const rr = state.riskRewards[p];
              const exSel = state.exileSelections[p];
              return (
                <div key={p} className={`rounded-2xl border-2 ${col.border} ${col.light} p-5`}>
                  <div className={`font-black text-xl ${col.text} mb-1`}>{p}</div>
                  <div className="text-xs text-gray-500 mb-3 font-mono">{fmt(state.challengeTimes[p])}</div>
                  {rr==='penalty'&&<div className="text-xs text-red-600 font-bold mb-2">ğŸ’€ Drafted last</div>}
                  {rr==='reward' &&<div className="text-xs text-green-600 font-bold mb-2">ğŸ† Had reward</div>}
                  <div className="font-bold text-gray-600 text-xs mb-2">TEAM</div>
                  <div className="space-y-1 mb-3">
                    {(state.teams[p]||[]).map((c,i)=>(
                      <div key={i} className={`${col.bg} text-white text-xs px-2 py-1.5 rounded-lg font-medium`}>{c}</div>
                    ))}
                  </div>
                  <div className="font-bold text-gray-600 text-xs mb-1">EXILE PICK</div>
                  <div className={`text-xs px-2 py-1 rounded font-bold ${exSel===0?'bg-purple-200 text-purple-800':'bg-teal-200 text-teal-800'}`}>
                    {exSel===0?'ğŸï¸ Tribe A':'ğŸï¸ Tribe B'}
                  </div>
                </div>
              );
            })}
          </div>

          {/* Exile tribes */}
          <div className="bg-white rounded-2xl border-2 border-gray-200 p-6">
            <h3 className="font-black text-2xl text-gray-800 mb-4">ğŸï¸ Exile Island Tribes</h3>
            <div className="grid grid-cols-2 gap-6">
              <div className="bg-purple-50 rounded-xl border-2 border-purple-400 p-4">
                <h4 className="font-black text-purple-800 mb-3">Tribe A</h4>
                {tribe1.map((c,i)=><div key={i} className="bg-purple-200 text-purple-900 px-3 py-2 rounded-lg font-medium mb-2 text-sm">{c}</div>)}
              </div>
              <div className="bg-teal-50 rounded-xl border-2 border-teal-400 p-4">
                <h4 className="font-black text-teal-800 mb-3">Tribe B</h4>
                {tribe2.map((c,i)=><div key={i} className="bg-teal-200 text-teal-900 px-3 py-2 rounded-lg font-medium mb-2 text-sm">{c}</div>)}
              </div>
            </div>
          </div>

          {/* Full rankings table */}
          <div className="bg-white rounded-2xl border-2 border-gray-200 overflow-x-auto">
            <div className="p-4 border-b border-gray-200">
              <h3 className="font-black text-xl text-gray-800">ğŸ“‹ Full Rankings Breakdown</h3>
            </div>
            <table className="w-full text-xs">
              <thead>
                <tr className="bg-orange-50 border-b-2 border-orange-200">
                  <th className="p-2 text-left font-black text-gray-600">Rank</th>
                  {state.draftOrder.map((p,i) => (
                    <th key={p} className="p-2 text-center font-black">
                      <div className={`inline-flex flex-col items-center`}>
                        <div className={`w-7 h-7 rounded-full text-white flex items-center justify-center font-black text-sm mb-1 ${PLAYER_COLORS[p].bg}`}>{i+1}</div>
                        <span className={PLAYER_COLORS[p].text}>{p}</span>
                      </div>
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {Array.from({length:24},(_,i)=>i+1).map(rank=>(
                  <tr key={rank} className="border-b border-gray-100 hover:bg-orange-50/30">
                    <td className="p-2 font-black text-gray-500">{rank}</td>
                    {state.draftOrder.map(p=>{
                      const c = state.rankings[p]?.[rank];
                      const isT = state.teams[p]?.includes(c);
                      const isE = (state.exileTribe||[]).includes(c);
                      return (
                        <td key={p} className={`p-1.5 text-center ${isT?'bg-green-50 font-bold text-green-800':isE?'bg-red-50 text-red-600':''}`}>
                          {c||'â€”'}
                        </td>
                      );
                    })}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {/* Reset */}
          <div className="bg-red-50 rounded-2xl border-2 border-red-300 p-6">
            <h3 className="font-black text-red-800 mb-3">ğŸ”¥ Reset Draft</h3>
            <div className="flex gap-3">
              <input value={code} onChange={e=>setCode(e.target.value.toUpperCase())}
                placeholder="Enter proctor code (SURVIVOR50)"
                className="flex-1 px-4 py-2 border-2 border-red-300 rounded-xl focus:outline-none focus:border-red-500 font-mono"/>
              <button onClick={reset} className="bg-red-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-red-700 border-2 border-red-800">Reset</button>
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROOT APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function App() {
      const { state, save, reset, ready } = useFirebase();

      if (!ready) return (
        <div className="min-h-screen flex items-center justify-center bg-amber-50">
          <div className="text-3xl font-black text-orange-600 animate-pulse">Loading Survivor 50...</div>
        </div>
      );

      const phase = state.phase || 'hub';

      return (
        <div className="min-h-screen bg-gradient-to-br from-amber-100 via-orange-50 to-red-100 p-4 md:p-6">
          {phase === 'hub'         && <HubScreen        state={state} save={save} />}
          {phase === 'draft'       && <DraftScreen      state={state} save={save} />}
          {phase === 'rewardSwap'  && <RewardSwapScreen state={state} save={save} />}
          {phase === 'exileSelect' && <ExileSelectScreen state={state} save={save} />}
          {phase === 'exileChoice' && <ExileSelectScreen state={state} save={save} />}
          {phase === 'complete'    && <CompleteScreen   state={state} save={save} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
